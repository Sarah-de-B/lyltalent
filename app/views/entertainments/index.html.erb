<div class="container.entertainement">

  <div class="container-header">
      <%= link_to root_path do %>
        <%= image_tag "lyltatent_logo.png", alt: "Ma photo", class: "lyl-logo-entertainments" %>
      <% end %>
      <% if user_signed_in? %>
        <% if current_user.role == "artiste" %>
          <%= link_to  "Organisateur",
              destroy_user_session_path,
              methode: :delete,
              data: { turbo_method: :delete, turbo_confirm: "Vous allez être déconnecté pour vous reconnecter en tant qu'organisateur. Continuer ?"},
              class: "top-right-btn btn-orga" %>
        <% elsif current_user.role == "organisateur d'événements" %>
          <%= link_to " Artiste",
              destroy_user_session_path,
              method: :delete,
              class: "top-right-btn btn-orga",
              data: {
                turbo_method: :delete, turbo_confirm: "Vous allez être déconnecté pour vous reconnecter en tant qu'artiste. Continuer ?"
              } %>
        <% end %>
      <% else %>
        <%= link_to "Se connecter", new_user_session_path, class: "top-right-btn btn-orga" %>
      <% end %>
  </div>

  <div class="search-bar">
    <%= form_with url: entertainments_path, method: :get, class: "search-form", local: true do %>
        <div class="input-wrapper">
          <%= text_field_tag :query, params[:query], class: "search-input", placeholder: "Tape une ville..." %>
          <button type="submit" class="search-btn">
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>
        </div>
    <% end %>
  </div>

  <h1 id="title-entertainment">Événements à venir</h1>
    <p id="sous-entertainment">En Recherche d'Artiste</p>

  <div class="button">
    <%= link_to "Liste | Carte", map_entertainments_path, class: "btn-white" %>
  </div>

  <% if @entertainments.empty? %>
    <div class="no-entertainments">
      <p>Pas d'événements disponibles dans cette ville. Revenez plus tard !</p>
    </div>
  <% else %>
  <div class="entertainments-cards">
    <% @entertainments.each do |entertainment| %>
      <%= link_to entertainment_path(entertainment), class: "entertainment-card-link" do %>
        <div class="entertainment-card">
          <% if entertainment.event.photo.attached? %>
            <%= cl_image_tag(entertainment.event.photo.key, height: 160, width: 250, crop: :fill, alt: "Image de l'événement", class: "card-image") %>
          <% else %>
           <%= image_tag "default_event.jpg", alt: "Image par défaut" %>
          <% end %>

          <div class="card-content">
            <h3><%= entertainment.event.name %></h3>
            <p><i class="fas fa-solid fa-calendar-days me-2" style="margin-right: 8px;"></i><%= l(entertainment.event.date, format: '%d/%m/%Y') %></p>
            <p><i class="fas fa-music" style="margin-right: 4px;"></i> Ambience <%= entertainment.event.musical_styles.join(', ') %></p>
            <%if entertainment.instruments.include?('Chanteur') && entertainment.artist_type == 'Soliste'%>
              <% ordered_instruments = entertainment.instruments.partition { |i| i == 'Chanteur' }.flatten %>
              <p> <i class="fas fa-search" style="margin-right: 3px;"></i>  Recherche un <%= ordered_instruments.join(' / ') %></p>
            <% else %>
              <p><i class="fas fa-search" style="margin-right: 3px;"></i>   Recherche <%= entertainment.artist_type %> avec : </p>
              <% if entertainment.instruments.any?  %>
                <p class='instrument-margin'> <%= entertainment.instruments.join(', ') %></p>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
<% end %>
